<!--
Copyright 2016 United States Government as represented by the Administrator
of the National Aeronautics and Space Administration. All Rights Reserved.

Portion of this code is Copyright Geoscience Australia, Licensed under the
Apache License, Version 2.0 (the "License"); you may not use this file
except in compliance with the License. You may obtain a copy of the License
at

   http://www.apache.org/licenses/LICENSE-2.0

The CEOS 2 platform is licensed under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance with the License.
You may obtain a copy of the License at
http://www.apache.org/licenses/LICENSE-2.0.

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
License for the specific language governing permissions and limitations
under the License.
-->
<!-- Author: AHDS
     Creation date: 2016-06-23
     Modified by:
     Last modified date: -->
{% block css %}
{% endblock %}

<div id="output_list" class="boxed_list panel-group">
  {% for task in tasks %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#output_list" href="#output_{{ forloop.counter0 }}" onmousedown="outputClicked('{{ task.id }}')">
          {{ task.title }}  : Submitted {{ task.execution_start|date:"m/d/Y H:i" }}</a>
        </h4>
      </div>
      <div id="output_{{ forloop.counter0 }}" class="panel-collapse collapse">
        <div class="panel-body">
          {% block table_rows %}
          {% endblock %}
        </div>
      </div>
    </div>
  {% endfor %}
</div>
<div class="form-inline">
  <select class="form-control" id="download_sel" name="download_sel" tabindex="1" onchange="set_dl_url();">
      <!-- Contains <option value=""></option> tags for all downloadable products.
           Will be parsed with the download function.                             -->
      {% block download_options %}
      {% endblock %}
  </select>
  <a id="output_list_download_button" href="" target="_blank" download class="tooltipped btn btn-primary pull-right" title="Download the selected mosaic in your chosen format.">Download Selected</a>
</div>
<h2>Data Guide</h2>
<hr>
<div id="data_guide" class="boxed_list">
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>Band</th>
        <th>Data</th>
        <th>Valid Range</th>
      </tr>
    </thead>
    <tbody>
      {% block data_guide_rows %}
      {% endblock %}
    </tbody>
  </table>
</div>
<a href="{% block url_block %}{% endblock %}" target="_blank">More information</a>
<script>
  //This needs to include a function called download_product() that includes all the logic required to parse
  //the options in download_options.
  {% block download_function %}
  {% endblock %}

  $(".tooltipped").tooltip();

  var selected_output = "";
  $("#output_list_download_button").hide();
  function outputClicked(id) {
      $("#output_list_download_button").show();
      //$("#output_list .selectTask").removeClass('sel_high');
      //$("#output_" + id).addClass('sel_high')
      selected_output = id;
      set_dl_url();
      set_selected_result(id);
  }

  function set_dl_url() {
      dl_link = "";
      if(tasks[selected_output]){
        dl_link += tasks[selected_output][$('#download_sel').val()];
        if($('#download_sel').val() == "animation_path" && tasks[selected_output].animation_path == "None")
          return;
        //window.open(dl_link, '_blank');
        $("#output_list_download_button").attr("href", dl_link);
        $("#output_list_download_button").attr("download", $("#download_sel option:selected").text().replace(/ /g,"_") + "." + dl_link.split('.').pop());
      }
  }
</script>
